"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[3040,9430],{52191:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var a=n(89379),o=n(9950),i=n(80415),l=n(44414);function s(e){let{uploadFile:t}=e;return(0,l.jsx)("div",{className:"pb_cards",children:(0,l.jsxs)("div",{className:"pb_cards_box",children:[(0,l.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/camera.svg"),alt:"camera"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Photobooth"}),(0,l.jsx)("p",{className:"pb_card-description",children:" Add fun stickers and backgrounds before sharing your masterpiece."})]}),(0,l.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/snapup.svg"),alt:"snapup"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Snap & Share"}),(0,l.jsx)("p",{className:"pb_card-description",children:"Upload your photos in one go without logging into your social media accounts."})]})]})})}const c=e=>{let{className:t,children:n,icon:a,onClick:o}=e;return(0,l.jsxs)("button",{className:t,onClick:o,children:[a&&(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/").concat(a,".svg"),alt:a}),n]})};var r=n(11766),d=n.n(r),u=n(75809),h=n(52867),m=n(16445);const g=e=>{let{facingMode:t,setFacingMode:n,rawImage:s,cameraPermission:c,capturedImage:r,mode:g,counter:v,canvasRef:x,canvasCursor:p,webcamRef:f,onMouseDown:b,onMouseMove:w,onMouseUp:y,canvasElements:_,activeTextIndex:k,setCanvasElements:j,loading:S}=e;const[M,I]=(0,o.useState)(Math.random()),[C,E]=(0,o.useState)([]),[T,N]=(0,o.useState)(null),[A,R]=(0,o.useState)(!1),F=(0,h.ew)(),P=e=>e?e.split("\n").length:1,B=(0,o.useMemo)(h.qs,[]),{initialWidthRatio:L,initialHeightRatio:z}=(0,o.useMemo)(()=>(0,m.c$)(r),[r]),D=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!x.current||!_[k])return e;const t=_[k],n=document.createElement("canvas").getContext("2d"),a=t.fontSize||16,o=t.fontFamily||"Arial";n.font="".concat(a,"px ").concat(o);const i=e.split(/\s+/);let l="",s="";const c=e=>{let t="";for(let a of e){const e=t+a;n.measureText(e).width>270&&t?(s+=t+"\n",t=a):t=e}return t};for(let r of i){let e=l?l+" "+r:r;n.measureText(e).width>270?l?(s+=l+"\n",l=n.measureText(r).width>270?c(r):r):l=c(r):l=e}return l&&(s+=l),s})(t);j(t=>t.map((t,n)=>n===k?(0,a.A)((0,a.A)({},t),{},{text:e}):t))}},W=(0,o.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),n=e.fontSize||16,a=e.fontFamily||"Arial",o=e.scale||1;t.font="".concat(n,"px ").concat(a);const i=e.text.split("\n");return Math.max(...i.map(e=>t.measureText(e).width))*o},[]);(0,o.useEffect)(()=>((async()=>{try{setTimeout(()=>{I(Date.now())},2e3)}catch(e){console.error("Error starting camera:",e)}})(),()=>X()),[]),(0,o.useEffect)(()=>{navigator.mediaDevices.enumerateDevices().then(e=>{const t=e.filter(e=>{let{kind:t}=e;return"videoinput"===t});console.log("Available cameras:",t),E(t),t.length>1?N(t[t.length-1].deviceId):t[0]&&N(t[0].deviceId)})},[]);const Y=C.filter(e=>e.label.toLowerCase().includes("front")),O=C.filter(e=>e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear")),U=(0,o.useCallback)(e=>{if(F)n(e=>"user"===e?"environment":"user"),I(e=>e+1);else{let t=null;if(t="user"==e?O[0]||Y[0]:Y[0]||O[0],t){const e=(e=>{const t=e.label.toLowerCase();return t.includes("front")?"user":t.includes("back")||t.includes("rear")?"environment":"unknown"})(t);N(t.deviceId),n(e),R(!0),I(e=>e+1)}else console.warn("\u26a0\ufe0f No suitable front or back camera found")}},[A,C.length,f]),X=()=>{setTimeout(()=>{var e;null!==f&&void 0!==f&&f.current&&((null===f||void 0===f||null===(e=f.current)||void 0===e?void 0:e.stream)&&f.current.stream.getTracks().forEach(e=>e.stop()))},1e3)};return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"pb_user_photo ".concat(S?"active_blur":""),style:{position:"relative",display:s?"none":r||"granted"===c?"flex":"none"},children:["capture"!==g||r?r?(0,l.jsx)("canvas",{ref:x,style:{cursor:p,width:"".concat(u.cO,"px"),height:"".concat(u.ps,"px")},onMouseDown:b,onMouseMove:w,onMouseUp:y,onMouseLeave:y,onTouchStart:function(e){const t=e.type.startsWith("touch");e.preventDefault();const n=e.touches[0],a={clientX:n.clientX,clientY:n.clientY};b(a,t)},onTouchMove:function(e){e.preventDefault();const t=e.touches[0],n={clientX:t.clientX,clientY:t.clientY};w(n)},onTouchEnd:function(e){e.preventDefault(),y()}}):(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/avatar.png?v=1.0.1"),alt:"default-avatar",width:u.cO,height:u.ps}):(0,l.jsx)(d(),{ref:f,screenshotFormat:"image/png",width:u.cO,height:u.ps,mirrored:!1,videoConstraints:A&&!F?{deviceId:{exact:T}}:{facingMode:t,width:{min:640,ideal:1920,max:3840},height:{min:480,ideal:1080,max:2160}},style:{objectFit:"cover",borderRadius:"8px",transform:"user"==t?"scaleX(-1)":"scaleX(1)"}},"".concat(M,"-").concat(t,"-").concat(g)),null===_||void 0===_?void 0:_.map((e,t)=>k===t&&(0,l.jsx)("textarea",{id:"text-".concat(t),name:"text-".concat(t),value:e.text,onChange:D,wrap:"hard",style:{position:"absolute",top:"".concat(e.y/z-(e.fontSize*e.scale*P(e.text)+e.scale*z)/2,"px"),left:"".concat(e.x/L-W(e)/2-(B?3:0),"px"),width:"".concat(W(e),"px"),height:"".concat(e.fontSize*e.scale*P(e.text)+5,"px"),fontSize:"".concat(e.fontSize*e.scale,"px"),fontFamily:e.fontFamily||"Arial",transform:"rotate(".concat(e.rotation||0,"deg)"),textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"none"}},t)),"capture"===g&&B&&!r?(0,l.jsx)("button",{onClick:()=>U(t),children:(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/camera-flip.svg"),alt:"flip-camera"})}):null,v?(0,l.jsxs)("div",{className:"pb_viewframe",children:[(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/viewframe-white@3x.svg"),alt:"viewframe"})," ",(0,l.jsx)("span",{children:v})]}):null]})})},v=o.memo(g),x=e=>{let{addSticker:t,loading:n,stickers:a,selectedStickers:o}=e;return(0,l.jsx)("div",{className:"pb_tabs_content_box",children:(0,l.jsx)("div",{className:"pb_list_items pb_stickers",children:a.map((e,a)=>{const i=null===o||void 0===o?void 0:o.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,l.jsx)("img",{onClick:n?null:()=>t(e),style:{cursor:n?"not-allowed":"pointer"},className:i?"active":"",src:"".concat(e,"?v=").concat(u.P_),alt:"sticker",width:64,height:64},a)})})})};var p=n(25825);const f=["font","align","color","bg"],b=["Georgia","Arial","Helvetica","Times New Roman","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],w=["left","center","right"],y=["white","black","transparent"],_=e=>{var t,n;let{canvasElements:s,setCanvasElements:c,activeTextIndex:r,addTextElement:d}=e;const[u,h]=(0,o.useState)(0),m=(0,o.useRef)(null);return(0,o.useEffect)(()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[]),(0,l.jsxs)(l.Fragment,{children:[u?(0,l.jsx)("div",{ref:m,children:(0,l.jsx)(p.xk,{color:null!==(t=null===(n=s[r])||void 0===n?void 0:n.color)&&void 0!==t?t:"black",onChange:e=>c(t=>t.map((t,n)=>n===r?(0,a.A)((0,a.A)({},t),{},{color:e.hex}):t))})}):null,(0,l.jsxs)("div",{className:"pb_tabs_content_box",children:[(0,l.jsx)("div",{className:"pb_text",children:f.map(e=>(0,l.jsxs)("div",{className:"pb_text_box",onClick:()=>(e=>{if(null!==r){const u={};if("color"===e)return void h(1);if("align"===e){var t,n;const e=null!==(t=null===(n=s[r])||void 0===n?void 0:n.align)&&void 0!==t?t:"center",a=w.find(t=>t===e);u.align=w[(w.indexOf(a)+1)%w.length]}else if("bg"===e){var o,i;const e=null!==(o=null===(i=s[r])||void 0===i?void 0:i.backgroundColor)&&void 0!==o?o:"transparent",t=y.find(t=>t===e);u.backgroundColor=y[(y.indexOf(t)+1)%y.length]}else if("font"===e){var l,d;const e=null!==(l=null===(d=s[r])||void 0===d?void 0:d.fontFamily)&&void 0!==l?l:"Arial",t=Math.max(0,b.indexOf(e));u.fontFamily=b[(t+1)%b.length]}c(e=>e.map((e,t)=>t===r?(0,a.A)((0,a.A)({},e),u):e))}})(e),children:[(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/text/").concat(e,".png?v=1"),alt:e}),(0,l.jsx)("p",{children:e})]},e))}),(0,l.jsx)("div",{className:"pb_add_text",children:(0,l.jsx)("p",{onClick:d,children:"Add Text"})})]})]})},k=e=>{let{loading:t,imgUrl:n,imgList:a,setImgUrl:o,tabKey:s,capturedImage:c=null}=e;return(0,l.jsx)("div",{className:"pb_tabs_content_box",children:(0,l.jsx)("div",{className:"pb_list_items pb_".concat(s),children:["".concat(i.th,"/media/images/photobooth/").concat(s,"/none.png"),...a].map((e,a)=>{const i=n?n===e:0===a;return(0,l.jsxs)("div",{className:"pb_list_images ".concat(i?"active":""),children:[c&&0!==a?(0,l.jsx)("img",{className:"pb_list_user_img",src:null===c||void 0===c?void 0:c.src,alt:"captured-image",width:64,height:64}):null,(0,l.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:"".concat(e,"?v=").concat(u.P_),alt:"img-".concat(a),className:"pb_list_frames",width:64,height:64,onClick:t?null:()=>o(0==a?null:e)})]},a)})})})},j=e=>{let{capturedImage:t,uploadFile:n,canvasRef:a,canvasCursor:s,selectedBg:r,setSelectedBg:d,selectedFrame:m,setSelectedFrame:g,addSticker:p,addTextElement:f,onMouseDown:b,onMouseMove:w,onMouseUp:y,canvasElements:j,setCanvasElements:S,activeTextIndex:M,loading:I,selectedStickers:C,photoBoothSettings:E,setActiveStickerIndex:T,setActiveTextIndex:N,activeText:A}=e;const[R,F]=(0,o.useState)("background"),[P,B]=(0,o.useState)([]),[L,z]=(0,o.useState)([]),[D,W]=(0,o.useState)([]);return(0,o.useEffect)(()=>{"text"===R&&0===j.length&&f(),"text"!==R?N(null):"sticker"!==R&&T(null)},[R]),(0,o.useEffect)(()=>{const e=(0,h.S3)((null===E||void 0===E?void 0:E.photo_booth_frames)||[]),t=(0,h.S3)((null===E||void 0===E?void 0:E.photo_booth_backgrounds)||[]),n=(0,h.S3)((null===E||void 0===E?void 0:E.photo_booth_stickers)||[]);z(null===e||void 0===e?void 0:e.map(e=>"".concat(i.on,"images/photobooth/frames/").concat(e))),B(null===t||void 0===t?void 0:t.map(e=>"".concat(i.on,"images/photobooth/backgrounds/").concat(e))),W(null===n||void 0===n?void 0:n.map(e=>"".concat(i.on,"images/photobooth/stickers/").concat(e)))},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"pb_customization",children:[(0,l.jsx)(v,{loading:I,capturedImage:t,canvasRef:a,canvasCursor:s,onMouseDown:b,onMouseMove:w,onMouseUp:y,canvasElements:j,activeTextIndex:M,setCanvasElements:S,activeText:A}),(0,l.jsxs)("div",{className:"pb_tabs",children:[(0,l.jsx)("div",{className:"pb_tabs_list",children:u.br.map(e=>(0,l.jsx)("button",{onClick:()=>F(e.id),className:R===e.id?"active":"",children:e.label},e.id))}),(0,l.jsx)("div",{className:"pb_tabs_content",children:"background"===R?(0,l.jsx)(k,{loading:I,imgUrl:r,imgList:P,setImgUrl:d,tabKey:"backgrounds"}):"frame"===R?(0,l.jsx)(k,{imgUrl:m,imgList:L,setImgUrl:g,tabKey:"frames",capturedImage:t}):"sticker"===R?(0,l.jsx)(x,{stickers:D,addSticker:p,loading:I,selectedStickers:C}):"text"===R?(0,l.jsx)(_,{canvasElements:j,setCanvasElements:S,activeTextIndex:M,addTextElement:f}):null})]})]}),(0,l.jsx)("div",{className:"pb_continue_buttons_main",children:(0,l.jsx)(c,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==a&&void 0!==a&&a.current){const e=a.current;T(null),N(null),setTimeout(()=>{const t=e.toDataURL("image/png",1);t&&n(2,t)},100)}}})})]})};var S=n(66345);function M(e){const{snapType:t,uploadType:n,rawImage:a,capturedImage:o,wall:s,uploadImg:c,backAction:r}=e,d=1===t&&1===n||3===t&&!a&&!o;return(0,l.jsxs)("div",{className:"pb_header_bar",onClick:d?()=>window.location.href="".concat(S.iT).concat(s.Wall.id,"?social-wall=true"):r,children:[(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/arrow-back.svg"),alt:"arrow-back"}),(0,l.jsx)("span",{className:"header-title",children:d?"Back to Wall":"Back"})]})}var I=n(69522);const C=e=>{let{imageUrl:t,photoBtnRef:n,customiseImage:a}=e;const s=(0,o.useRef)(null),c=(0,o.useRef)(null),r=(0,o.useRef)(null),d=(0,o.useRef)(1),[u,h]=(0,o.useState)(!0),[m,g]=(0,o.useState)({width:200,height:200}),[v,x]=(0,o.useState)({x:0,y:0}),[p,f]=(0,o.useState)(1),b=320,w=320,y=(0,o.useCallback)(()=>{const e=c.current;if(!e)return console.error("Original image not loaded."),null;const t=e.naturalWidth/m.width,n=e.naturalHeight/m.height,o=-v.x/p*t,i=-v.y/p*n,l=b/p*t,s=w/p*n,r=document.createElement("canvas");r.width=l,r.height=s;r.getContext("2d").drawImage(e,o,i,l,s,0,0,l,s),r.toBlob(e=>{if(e){const t=new File([e],"capture.png",{type:"image/png"});a(t)}},"image/png")},[v,p,m,b,w,a]);(0,o.useEffect)(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const t=e.width/e.height;let n,a;t>1?(a=w,n=a*t):(n=b,a=n/t),g({width:n,height:a}),x({x:(b-n)/2,y:(w-a)/2})},e.src=t},[t]);const _=m.width*p,k=m.height*p,j=e=>{const[t,n]=e,a=t.clientX-n.clientX,o=t.clientY-n.clientY;return Math.sqrt(a*a+o*o)},S=e=>{2===e.touches.length&&(r.current=j(e.touches),d.current=p)},M=e=>{if(2===e.touches.length){e.preventDefault();const t=j(e.touches),n=r.current,a=d.current;if(!n||!a)return;const o=t/n;let i=Math.max(1,a*o);f(i)}};return(0,o.useEffect)(()=>{const e=s.current;if(e)return e.addEventListener("touchstart",S,{passive:!1}),e.addEventListener("touchmove",M,{passive:!1}),()=>{e.removeEventListener("touchstart",S),e.removeEventListener("touchmove",M)}},[p]),(0,o.useEffect)(()=>{const e=setTimeout(()=>{h(!1)},2500);return()=>clearTimeout(e)},[]),(0,l.jsxs)("div",{style:{position:"relative",overflow:"hidden",margin:"0px auto 30px",background:"#f9f9f9",touchAction:"none",border:"2px dashed #aaa",borderRadius:"8px"},onWheel:e=>{e.preventDefault();const t=e.deltaY<0?.05:-.05,n=Math.max(1,p+t);if(n<=1.01&&_<=b&&k<=w){f(1);const e=(b-m.width)/2,t=(w-m.height)/2;x({x:e,y:t})}else f(n)},children:[(0,l.jsx)("div",{style:{width:b,height:w},ref:s,children:(0,l.jsx)(I.p,{size:{width:_,height:k},position:v,enableResizing:!1,disableDragging:!1,onDragStop:(e,t)=>{let n=t.x,a=t.y;const o=Math.max(0,_-b),i=Math.max(0,k-w);n=Math.min(Math.max(n,-o),0),a=Math.min(Math.max(a,-i),0),x({x:n,y:a})},style:{zIndex:2,pointerEvents:"auto"},children:(0,l.jsx)("img",{ref:c,src:t,alt:"Editable",style:{width:"100%",height:"100%",objectFit:"cover",userSelect:"none",pointerEvents:"none"}})})}),(0,l.jsx)("button",{ref:n,style:{display:"none",position:"absolute",top:10,right:10,zIndex:400},onClick:y,children:"Capture"}),u?(0,l.jsxs)("div",{className:"pb_take_photo_crop",children:[(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/arrow-left.svg"),alt:"arrow-left",width:50,height:50}),(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/arrow-right.svg"),alt:"arrow-right",width:50,height:50})]}):null]})};n(41377);const E=e=>{var t;let{uploadType:n,rawImage:a,takePhoto:s,canvasRef:r,canvasCursor:d,setRawImage:u,customisePhoto:h}=e;const g=(0,o.useRef)(null),x=(0,o.useRef)(null),p=(0,o.useRef)(null),[f,b]=(0,o.useState)(null),[w,y]=(0,o.useState)("capture"),[_,k]=(0,o.useState)(0),[j,S]=(0,o.useState)(null),[M,I]=(0,o.useState)("environment"),E=(0,o.useCallback)(async()=>{["Smile",3,2,1,0].forEach((e,t)=>{setTimeout(()=>b(e),1e3*t)})},[]),T=(0,o.useCallback)(()=>{y("capture"),u(null)},[]),N=(0,o.useCallback)(e=>{var t,n;const a=null===e||void 0===e||null===(t=e.target)||void 0===t||null===(n=t.files)||void 0===n?void 0:n[0];y("upload"),k(_+1),(0,m.u6)(a,"file",e=>s(e,!0))},[_]),A=(0,o.useCallback)(async e=>{var t;"capture"===e&&await E(),"upload"===e&&null!==g&&void 0!==g&&g.current&&await(null===g||void 0===g||null===(t=g.current)||void 0===t?void 0:t.click())},[]);(0,o.useEffect)(()=>{var e;if(0===f&&(null!==x&&void 0!==x&&null!==(e=x.current)&&void 0!==e&&e.video)){b(null);const e=x.current.video;if(!e)return;const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const n=t.getContext("2d");"user"===M&&(n.translate(t.width,0),n.scale(-1,1)),n.drawImage(e,0,0,t.width,t.height),t.toBlob(e=>{const t=new File([e],"captured-photo.png",{type:"image/png",lastModified:Date.now()});(0,m.He)(t,"file",()=>s(URL.createObjectURL(t),!0))},"image/png")}},[f]);return(0,o.useEffect)(()=>{/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)||(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});x.current&&(x.current.srcObject=e),S("granted")}catch(e){if(console.warn("Camera error:",e.name,e.message),navigator.permissions&&navigator.permissions.query)try{const e=await navigator.permissions.query({name:"camera"});return void S(e.state)}catch(t){console.log("Permissions API not supported (Safari likely)")}S("prompt")}})()},[]),(0,o.useEffect)(()=>{const e=async()=>{try{const e=await navigator.permissions.query({name:"camera"});e.state!==j&&S(e.state)}catch(e){console.warn("Permissions API not fully supported",e)}};return setInterval(e,2e3),()=>{clearInterval(e)}},[j]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"pb_user_photo_box",children:[a?(0,l.jsx)(C,{photoBtnRef:p,imageUrl:null!==(t=null===a||void 0===a?void 0:a.src)&&void 0!==t?t:"",customiseImage:e=>{(0,m.u6)(e,"file",e=>s(e,!1)),setTimeout(h,100)}}):null,(0,l.jsxs)(l.Fragment,{children:["  ",(0,l.jsx)(v,{setFacingMode:I,facingMode:M,cameraPermission:j,mode:w,rawImage:a,canvasRef:r,canvasCursor:d,webcamRef:x,counter:f}),(0,l.jsxs)("div",{id:"camera-disabled-message",className:"pb-camera-disabled",style:{display:"granted"===j||a?"none":"flex"},children:[(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/camera-disabled.svg"),alt:"camera-disabled"}),(0,l.jsxs)("p",{className:"pb_camera_disabled_text",children:["Please reload and allow camera",(0,l.jsx)("br",{}),"access when prompted."]}),(0,l.jsxs)("p",{className:"pb_camera_disabled_text_bottom",children:["In case this doesn't work, please",(0,l.jsx)("br",{}),"check the camera permissions in ",(0,l.jsx)("br",{}),"your browser settings."]})]})]}),a?(0,l.jsxs)("div",{className:"pb_take_photo",children:[(0,l.jsx)(c,{className:"pb_buttons_transparent",icon:"retake",children:"Try Again",onClick:T}),(0,l.jsx)(c,{className:"pb_buttons heighlight",children:"Looks Good!",onClick:()=>{var e;return null===p||void 0===p||null===(e=p.current)||void 0===e?void 0:e.click()}})]}):(0,l.jsxs)("div",{className:"pb_user_buttons",children:["granted"===j?(0,l.jsx)(c,{className:"pb_buttons heighlight",icon:"camera",children:"Strike a Pose",onClick:()=>A("capture")}):null,(0,l.jsx)(c,{className:"pb_buttons",icon:"upload",children:"Upload from Gallery",onClick:()=>A("upload")})]})]}),(0,l.jsx)("input",{ref:g,type:"file",accept:"image/*",style:{display:"none"},onChange:N},_)]})};var T=n(48768);const N=()=>(0,l.jsx)("div",{className:"pb_overlay_main",children:(0,l.jsxs)("div",{className:"pb_overlay_content",children:[(0,l.jsx)("img",{src:"".concat(i.on,"logos/socialwalls.gif"),alt:"loading",width:50,height:50}),(0,l.jsxs)("div",{className:"text-fade",children:[(0,l.jsx)("span",{children:"Mapping the subject to understand its unique shape"}),(0,l.jsx)("span",{children:"Defining the boundaries with razor-sharp precision"}),(0,l.jsx)("span",{children:"Enhancing the subject's prominence by removing the noise"}),(0,l.jsx)("span",{children:"Presenting your subject, now a standalone masterpiece"})]})]})}),A=e=>{var t,n,i,c;const r=(0,o.useRef)(null),d=(0,o.useRef)({}),g=(0,o.useRef)({}),[v,x]=(0,o.useState)(!1),[p,f]=(0,o.useState)(!1),[b,w]=(0,o.useState)(null),[y,_]=(0,o.useState)(null),[k,S]=(0,o.useState)(null),[I,C]=(0,o.useState)(!1),[A,R]=(0,o.useState)(0),[F,P]=(0,o.useState)(null),[B,L]=(0,o.useState)(null),[z,D]=(0,o.useState)([]),[W,Y]=(0,o.useState)([]),[O,U]=(0,o.useState)(null),[X,q]=(0,o.useState)(null),[H,$]=(0,o.useState)(null),[G,K]=(0,o.useState)(null===e||void 0===e?void 0:e.snapType),[V,J]=(0,o.useState)(null),[Q,Z]=(0,o.useState)(null),[ee,te]=(0,o.useState)(null),[ne,ae]=(0,o.useState)(null),[oe,ie]=(0,o.useState)(null),[le,se]=(0,o.useState)("default"),[ce,re]=(0,o.useState)({width:u.cO,height:u.ps}),de=(0,o.useMemo)(h.qs,[]),ue=e=>{x(e)},he=e=>{const t=r.current,n=t.getBoundingClientRect();return{x:(e.clientX-n.left)*(t.width/n.width),y:(e.clientY-n.top)*(t.height/n.height)}},me=e=>{const t=null===r||void 0===r?void 0:r.current;if(!t||null===e||void 0===e||!e.text)return 0;const n=t.getContext("2d");if(!n)return 0;n.save(),n.font="".concat(e.fontSize||20,"px ").concat(e.fontFamily||"Arial");const a=e.text.split("\n"),o=Math.max(...a.map(e=>n.measureText(e).width));return n.restore(),o};(0,o.useEffect)(()=>{if(!y)return;const e=r.current;if(!e)return;const t=e.getContext("2d"),n=ce.width,a=ce.height;e.width=n,e.height=a;const{initialWidthRatio:o,initialHeightRatio:i}=(0,m.c$)(y),l=Math.max(o,i),s=document.createElement("canvas");s.width=n,s.height=a;const c=s.getContext("2d");c.clearRect(0,0,n,a);let u=y;O&&B&&k&&(u=k,c.drawImage(B,0,0,n,a)),c.drawImage(u,0,0,n,a),c.globalCompositeOperation="source-over",F&&c.drawImage(F,0,0,n,a),z.forEach((t,n)=>{const a=t.img.width*t.scale,o=t.img.height*t.scale,i=t.x+a/2,s=t.y+o/2,r=.04*Math.max(e.width,e.height),u=.05*Math.max(e.width,e.height);if(c.save(),c.translate(i,s),c.rotate((t.rotation||0)*Math.PI/180),c.drawImage(t.img,-a/2,-o/2,a,o),n===ee){c.strokeStyle="#2b2b2b",c.lineWidth=2*l,c.setLineDash([5,3]),c.strokeRect(-a/2,-o/2,a,o),c.setLineDash([]);const e="\u2921",h=a/2,g=o/2;c.fillStyle="#000",c.beginPath(),c.arc(h,g-6,r,0,2*Math.PI),c.fill(),c.fillStyle="white",c.font="bold ".concat(22*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText(e,h,g-5);const v=a/2,x=-o/2;c.beginPath(),c.fillStyle="#000",c.arc(v,x,r,0,2*Math.PI),c.fill(),c.fillStyle="#fff",c.font="bold ".concat(22*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u27f3",v,x);const p=24,f=-a/2-p/2+5,b=-o/2-p/2+8,w=i+f,y=s+b,_=(0,m.sR)(w,y,i,s,t.rotation||0);d.current[n]={x:_.x,y:_.y,size:p},c.beginPath(),c.arc(f+4,b+4,r,0,2*Math.PI),c.fillStyle="black",c.fill(),c.fillStyle="#fff",c.font="bold ".concat(u,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u2715",f+5,b+5)}c.restore()}),W.forEach((e,t)=>{var n;c.save(),c.translate(e.x,e.y),c.rotate(e.rotation*Math.PI/180),c.scale(e.scale,e.scale),c.font="".concat(e.fontSize*l,"px ").concat(e.fontFamily||"Arial"),c.textAlign=e.align||"center",c.textBaseline="middle";const a=(null===(n=e.text)||void 0===n?void 0:n.split("\n"))||[],o=a.length,i=e.fontSize*l;c.font="".concat(i,"px ").concat(e.fontFamily||"Arial"),c.textAlign=e.align||"center",c.textBaseline="middle";const s=Math.max(...a.map(e=>c.measureText(e).width)),r=1.2*i,d=15*l,u=s+2*d,h=r*o+2*d,m=u,v=h,x=-m/2;if(e.backgroundColor&&(c.fillStyle=e.backgroundColor,c.fillRect(x,-v/2,m,v)),t!==Q&&(c.fillStyle=e.color||"#000000",a.forEach((e,t)=>{let n=0;"center"==c.textAlign?n=0:"left"==c.textAlign?n=-m/2+10:"right"==c.textAlign&&(n=m/2-10),c.fillText(e,n,t*r-(a.length-1)*r/2)})),t===Q){c.strokeStyle="#2b2b2b",c.lineWidth=2*l,c.setLineDash([5,3]),c.strokeRect(x,-v/2,m,v),c.setLineDash([]);const n=22,a=(e.rotation||0)*Math.PI/180,o=-u/2-n/2,i=-h/2-n/2,s=e.x+o*Math.cos(a)-i*Math.sin(a),r=e.y+o*Math.sin(a)+i*Math.cos(a);g.current[t]={x:s,y:r,size:Math.max(de?15:10,n*e.scale)},c.fillStyle="black",c.beginPath(),c.arc(x,-v/2,14*l,0,2*Math.PI),c.fill(),c.fillStyle="#fff",c.font="bold ".concat(16*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u2715",x,-v/2+2),c.fillStyle="black",c.beginPath(),c.arc(x+m,-v/2,14*l,0,2*Math.PI),c.fill(),c.fillStyle="white",c.font="bold ".concat(24*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u27f3",x+m+1,-v/2-1),c.fillStyle="black",c.beginPath(),c.arc(x+m,v/2,14*l,0,2*Math.PI),c.fill(),c.fillStyle="white",c.font="bold ".concat(24*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u2921",x+m,v/2)}c.restore()}),t.clearRect(0,0,n,a),t.drawImage(s,0,0)},[y,k,F,z,ee,W,Q,B,I,ce,G]),(0,o.useEffect)(()=>{if(!O)return void L(null);const t=new Image;t.crossOrigin="anonymous",t.src="https://cdn.taggbox.com/v7/".concat(O,"?v=").concat(u.P_),ue(!!k),t.onload=async()=>{if(!k){var n,a,o,i;f(!0);const t=await(0,m.wt)(null!==(n=null===y||void 0===y?void 0:y.src)&&void 0!==n?n:"",null!==(a=null===e||void 0===e||null===(o=e.wall)||void 0===o||null===(i=o.Wall)||void 0===i?void 0:i.owner)&&void 0!==a?a:"","removeBg");if(t){const e=new Image;e.crossOrigin="anonymous",e.src="https://cdn.taggbox.com/v7/".concat(t,"?v=").concat(u.P_),e.onload=()=>{S(e),f(!1)},e.onerror=()=>{S(null),f(!1),console.error("Failed to load background transparent image: ".concat(O))}}}L(t),ue(!1)},t.onerror=()=>{console.error("Failed to load background image: ".concat(O)),ue(!1)}},[O]),(0,o.useEffect)(()=>{if(!X)return void P(null);const e=new Image;e.crossOrigin="anonymous",e.src="https://cdn.taggbox.com/v7/".concat(X,"?v=").concat(u.P_),ue(!0),e.onload=()=>{P(e),ue(!1)},e.onerror=()=>{console.error("Failed to load frame image: ".concat(X)),ue(!1)}},[X]),(0,o.useEffect)(()=>{let e=0,t=!1;const n=[".pb_tabs_content_box",".pb_photo_booth_h_review"],a=a=>{e=a.touches[0].clientY;const o=a.target.closest(n.join(","));t=!!o},o=n=>{if(t)return;const a=document.documentElement.scrollTop||document.body.scrollTop,o=n.touches[0].clientY-e;0===a&&o>0&&n.preventDefault()};return document.addEventListener("touchstart",a,{passive:!1}),document.addEventListener("touchmove",o,{passive:!1}),()=>{document.removeEventListener("touchstart",a),document.removeEventListener("touchmove",o)}},[]);const ge=(e,t)=>{K(e),$(t),R(0)};return(0,l.jsx)("div",{className:"pb_photo_booth_main",children:(0,l.jsx)("div",{className:"pb_photo_booth_box",children:(0,l.jsxs)("div",{className:"pb_photo_booth_box_inner",children:[(0,l.jsx)(M,{snapType:e.snapType,rawImage:b,capturedImage:y,uploadImg:H,uploadType:G,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{I?(w(y),H&&!A?(C(!0),R(1),K(3),w(0)):(C(!1),R(0))):(C(!1),w(null),K(b?H&&2===G?3:G:null===e||void 0===e?void 0:e.snapType))}}),(0,l.jsx)("div",{className:"pb_photo_booth_h ".concat(2===G?"pb_photo_booth_h_review":""),children:1==G?(0,l.jsx)(s,{uploadFile:ge}):(0,l.jsx)(l.Fragment,{children:2===G?(0,l.jsx)(T.default,{isPhotoBooth:H,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(n=t.Wall)||void 0===n?void 0:n.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):I?(0,l.jsx)(j,{loading:v,capturedImage:y,uploadFile:ge,canvasRef:r,canvasCursor:le,selectedBg:O,setSelectedBg:U,selectedFrame:X,setSelectedFrame:q,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",ue(!0),t.src="https://cdn.taggbox.com/v7/".concat(e,"?v=").concat(u.P_),t.onload=()=>{ue(!1);const n=ce.width,a=ce.height,o=n/(de?4:3),i=t.height/t.width*o,l=o/t.width;t.height=t.height*l,t.width=t.width*l,Z(null),D(l=>{const s=[...l,{img:t,x:n/2-o/2,y:a/2-i/2,scale:1,url:e,rotation:0}];return te(s.length-1),s})},t.onerror=()=>{ue(!1),console.error("Failed to load sticker image: ".concat(e))}},addTextElement:()=>{const e={text:"Your Text Here",x:ce.width/2,y:ce.height/2,scale:1,rotation:0,fontSize:28,fontFamily:"Georgia",color:"#000000",backgroundColor:"white",align:"center"};te(null),Y(t=>{const n=[...t,e];return Z(n.length-1),n})},onMouseDown:e=>{const{x:t,y:n}=he(e);let a=!1,o=!1;for(let s=z.length-1;s>=0;s--){const e=z[s],{initialHeightRatio:o,initialWidthRatio:i}=(0,m.c$)(y),l=d.current[s];if(l){const{x:e,y:a,size:c}=l,r=t-e,d=n-a;if(Math.sqrt(r*r+d*d)<=Math.max(c,5*(i+o))*(de?1.5:1))return D(e=>e.filter((e,t)=>t!==s)),void te(null)}if((0,m.$u)(e,t,n,y)){te(s),ae("rotate"),ie({x:t,y:n,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),a=!0;break}if((0,m.By)(e,t,n,y)){te(s),ae("resize"),ie({x:t,y:n,initialScale:e.scale,initialWidth:e.img.width}),a=!0;break}if((0,m.s_)(e,t,n)){te(s),ae("move"),ie({x:t,y:n,initialX:e.x,initialY:e.y}),a=!0;break}}if(!a){const{initialHeightRatio:e,initialWidthRatio:a}=(0,m.c$)(y);for(let s=W.length-1;s>=0;s--){var i;const c=W[s],r=me(c),d=null===(i=g.current)||void 0===i?void 0:i[s];if(d){const{x:o,y:i,size:l}=d,c=W[s].scale||1,u=t-o,h=n-i;let m=1;c<.5?m=3.5:c<.6?m=3:c<.7?m=2.4:c<.8?m=1.9:c<.93&&(m=1.6);if(Math.sqrt(u*u+h*h)/m<Math.max(l,.02*r*c*(2*(a+e))))return Y(e=>e.filter((e,t)=>t!==s)),Z(null),void J(null)}if((0,m.gl)(c,t,n,r,y)){Z(s),J(null),ae("rotate-text"),ie({x:t,y:n,centerX:c.x,centerY:c.y,initialAngle:c.rotation||0}),o=!0;break}if((0,m.WB)(c,t,n,r,y)){J(null),Z(s),te(null),ae("resize-text"),ie({x:t,y:n,initialScale:c.scale,initialWidth:r}),o=!0;break}if((0,m.i)(c,t,n,r,y)){var l;J({index:s,count:Q==s?(null===V||void 0===V?void 0:V.count)>=2?2:(null!==(l=null===V||void 0===V?void 0:V.count)&&void 0!==l?l:0)+1:1}),Z(s),ae("move-text"),ie({x:t,y:n,initialX:c.x,initialY:c.y}),o=!0;break}}}a||o||(te(null),Z(null),ae(null),ie(null),J(null))},onMouseMove:e=>{const{x:t,y:n}=he(e);let o="default",i=!1;for(let a=W.length-1;a>=0;a--){const e=W[a],l=me(e);if((0,m.gl)(e,t,n,l,y)){o="crosshair",i=!0;break}if((0,m.WB)(e,t,n,l,y)){o="nwse-resize",i=!0;break}if((0,m.i)(e,t,n,l,y)){o="grab",i=!0;break}}if(!i)for(let a=z.length-1;a>=0;a--){const e=z[a];if((0,m.$u)(e,t,n,y)){o="crosshair",i=!0;break}if((0,m.By)(e,t,n,y)){o="nwse-resize",i=!0;break}if((0,m.s_)(e,t,n)){o="grab",i=!0;break}}if("move"!==ne||null===ee&&null===Q||(o="grabbing"),se(o),!ne||!oe)return;const l=t-oe.x,s=n-oe.y;null!==ee&&D(e=>{const o=[...e],i=(0,a.A)({},o[ee]);if("move"===ne)i.x=oe.initialX+l,i.y=oe.initialY+s;else if("resize"===ne){const e=oe.initialWidth*oe.initialScale+l,t=Math.max(.05,e/i.img.width);i.scale=t}else if("rotate"===ne){const e=Math.atan2(oe.y-oe.centerY,oe.x-oe.centerX),a=180*(Math.atan2(n-oe.centerY,t-oe.centerX)-e)/Math.PI;i.rotation=(oe.initialAngle+a)%360}return o[ee]=i,o}),null!==Q&&Y(e=>{const o=[...e],i=(0,a.A)({},o[Q]);if("move-text"===ne)i.x=oe.initialX+l,i.y=oe.initialY+s;else if("resize-text"===ne){const e=oe.initialWidth*oe.initialScale+l,t=Math.max(.1,e/me(i));i.scale=t}else if("rotate-text"===ne){const e=Math.atan2(oe.y-oe.centerY,oe.x-oe.centerX),a=180*(Math.atan2(n-oe.centerY,t-oe.centerX)-e)/Math.PI;i.rotation=(oe.initialAngle+a)%360}return o[Q]=i,o})},onMouseUp:()=>{ae(null),ie(null),se("default")},canvasElements:W,setCanvasElements:Y,activeTextIndex:Q,photoBoothSettings:null!==(i=null===e||void 0===e||null===(c=e.wall)||void 0===c?void 0:c.PhotoBoothSettings)&&void 0!==i?i:{},selectedStickers:z,setActiveStickerIndex:te,setActiveTextIndex:Z,activeText:V}):(0,l.jsx)(E,{uploadType:G,rawImage:b,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=async()=>{S(null),t?w(n):_(n),re({width:n.width,height:n.height})},n.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:r,canvasCursor:le,setRawImage:w,customisePhoto:()=>{w(null),P(null),L(null),D([]),Y([]),U(null),q(null),Z(null),te(null),C(!0)}})})}),p?(0,l.jsx)(N,{}):null]})})})}}}]);